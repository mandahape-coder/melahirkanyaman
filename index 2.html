<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Deteksi Nyeri & Darurat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .camera-section {
            text-align: center;
        }

        video {
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        canvas {
            border-radius: 10px;
            border: 2px solid #ddd;
        }

        .controls {
            margin: 15px 0;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }

        .emergency-btn {
            background: #dc3545 !important;
            font-size: 18px;
            padding: 15px 30px;
        }

        .emergency-btn:hover {
            background: #c82333 !important;
        }

        .pain-display {
            text-align: center;
            margin: 20px 0;
        }

        .pain-score {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }

        .pain-low { color: #28a745; }
        .pain-medium { color: #ffc107; }
        .pain-high { color: #dc3545; }

        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }

        .status-ok { background: #d4edda; color: #155724; }
        .status-warning { background: #fff3cd; color: #856404; }
        .status-error { background: #f8d7da; color: #721c24; }

        .emergency-section {
            background: #ffe6e6;
            border: 2px solid #ff9999;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .log-section {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 5px;
        }

        .log-entry {
            background: #f1f1f1;
            padding: 8px;
            margin: 5px 0;
            border-radius: 3px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <h1>üè• Sistem Deteksi Nyeri & Darurat Persalinan</h1>
            <p>Monitoring real-time skala nyeri dengan AI</p>
        </header>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Camera Section -->
            <div class="card">
                <h3>üìπ Kamera Monitor</h3>
                <div class="camera-section">
                    <video id="video" autoplay playsinline muted></video>
                    <canvas id="overlay" style="display: none;"></canvas>
                    
                    <div class="controls">
                        <select id="cameraSelect">
                            <option>Pilih Kamera</option>
                        </select>
                        <button id="startBtn">Mulai Kamera</button>
                        <button id="snapBtn">Ambil Foto</button>
                    </div>
                    
                    <div id="cameraStatus" class="status status-warning">
                        Menunggu akses kamera...
                    </div>
                </div>
            </div>

            <!-- Pain Scale Section -->
            <div class="card">
                <h3>üìä Skala Nyeri</h3>
                <div class="pain-display">
                    <div>Skor Nyeri Saat Ini</div>
                    <div id="painScore" class="pain-score pain-low">0</div>
                    <div id="painLevel">Tidak ada nyeri</div>
                </div>
                
                <div class="status status-ok" id="painStatus">
                    Kondisi normal
                </div>
            </div>
        </div>

        <!-- Emergency Section -->
        <div class="emergency-section">
            <h3>üö® Sistem Darurat</h3>
            <p>Tekan tombol di bawah jika memerlukan bantuan medis segera</p>
            <button class="emergency-btn" id="emergencyBtn">
                üöë PANGGIL BANTUAN DARURAT
            </button>
            <div id="emergencyStatus" style="margin-top: 15px; font-weight: bold;"></div>
        </div>

        <!-- Information & Log -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
            <!-- Guidance -->
            <div class="card">
                <h3>üí° Panduan</h3>
                <div id="guidance">
                    <p>Mulai kamera untuk memulai monitoring nyeri secara otomatis.</p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>Pastikan wajah menghadap kamera</li>
                        <li>Pencahayaan yang cukup</li>
                        <li>Posisi duduk atau berbaring nyaman</li>
                    </ul>
                </div>
            </div>

            <!-- Activity Log -->
            <div class="card">
                <h3>üìã Log Aktivitas</h3>
                <div id="activityLog" class="log-section">
                    <div class="log-entry">Sistem siap digunakan</div>
                </div>
            </div>
        </div>

        <!-- Snapshot Display -->
        <div class="card" style="margin-top: 20px;">
            <h3>üì∏ Snapshot</h3>
            <canvas id="snapshot" style="max-width: 100%; border: 1px solid #ddd;"></canvas>
        </div>
    </div>

    <script>
        // Basic variables
        let video = document.getElementById('video');
        let overlay = document.getElementById('overlay');
        let snapshot = document.getElementById('snapshot');
        let cameraSelect = document.getElementById('cameraSelect');
        let isRunning = false;
        let currentStream = null;

        // Initialize camera list
        async function loadCameras() {
            try {
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(device => device.kind === 'videoinput');
                
                cameraSelect.innerHTML = '<option>Pilih Kamera</option>';
                videoDevices.forEach((device, index) => {
                    const option = document.createElement('option');
                    option.value = device.deviceId;
                    option.text = device.label || `Kamera ${index + 1}`;
                    cameraSelect.appendChild(option);
                });
                
                updateStatus('Kamera tersedia', 'ok');
            } catch (error) {
                updateStatus('Gagal memuat kamera', 'error');
            }
        }

        // Start camera
        async function startCamera() {
            try {
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                }

                const deviceId = cameraSelect.value;
                currentStream = await navigator.mediaDevices.getUserMedia({
                    video: { deviceId: deviceId ? { exact: deviceId } : undefined }
                });

                video.srcObject = currentStream;
                await video.play();
                
                overlay.width = video.videoWidth;
                overlay.height = video.videoHeight;
                
                isRunning = true;
                updateStatus('Kamera aktif', 'ok');
                addLog('Kamera dimulai');
                
                // Start pain detection simulation
                startPainDetection();
                
            } catch (error) {
                updateStatus('Gagal mengakses kamera', 'error');
                addLog('Error: ' + error.message);
            }
        }

        // Basic pain detection simulation
        function startPainDetection() {
            setInterval(() => {
                if (isRunning) {
                    // Simulate pain score (0-10)
                    const painScore = Math.floor(Math.random() * 11);
                    updatePainDisplay(painScore);
                }
            }, 2000);
        }

        // Update pain display
        function updatePainDisplay(score) {
            const painScoreEl = document.getElementById('painScore');
            const painLevelEl = document.getElementById('painLevel');
            const painStatusEl = document.getElementById('painStatus');

            painScoreEl.textContent = score;

            // Update pain level and colors
            if (score <= 3) {
                painScoreEl.className = 'pain-score pain-low';
                painLevelEl.textContent = 'Nyeri ringan';
                painStatusEl.textContent = 'Kondisi normal';
                painStatusEl.className = 'status status-ok';
            } else if (score <= 6) {
                painScoreEl.className = 'pain-score pain-medium';
                painLevelEl.textContent = 'Nyeri sedang';
                painStatusEl.textContent = 'Perlu perhatian';
                painStatusEl.className = 'status status-warning';
            } else {
                painScoreEl.className = 'pain-score pain-high';
                painLevelEl.textContent = 'Nyeri berat';
                painStatusEl.textContent = 'PERLU BANTUAN MEDIS!';
                painStatusEl.className = 'status status-error';
                
                // Auto emergency alert for high pain
                if (score >= 8) {
                    triggerEmergencyAlert();
                }
            }

            updateGuidance(score);
        }

        // Update guidance based on pain level
        function updateGuidance(score) {
            const guidanceEl = document.getElementById('guidance');
            
            if (score <= 3) {
                guidanceEl.innerHTML = `
                    <p><strong>Nyeri Ringan (${score}/10)</strong></p>
                    <ul>
                        <li>Atur posisi yang nyaman</li>
                        <li>Tarik napas dalam-dalam</li>
                        <li>Rileks dan tetap tenang</li>
                    </ul>
                `;
            } else if (score <= 6) {
                guidanceEl.innerHTML = `
                    <p><strong>Nyeri Sedang (${score}/10)</strong></p>
                    <ul>
                        <li>Ganti posisi secara berkala</li>
                        <li>Gunakan teknik pernapasan</li>
                        <li>Minta dukungan pendamping</li>
                    </ul>
                `;
            } else {
                guidanceEl.innerHTML = `
                    <p><strong>Nyeri Berat (${score}/10)</strong></p>
                    <ul>
                        <li>Segera hubungi tenaga medis</li>
                        <li>Jangan tinggalkan pasien sendiri</li>
                        <li>Siapkan untuk intervensi medis</li>
                    </ul>
                `;
            }
        }

        // Take snapshot
        function takeSnapshot() {
            if (!isRunning) {
                alert('Kamera belum aktif');
                return;
            }

            const ctx = snapshot.getContext('2d');
            snapshot.width = video.videoWidth;
            snapshot.height = video.videoHeight;
            ctx.drawImage(video, 0, 0);
            
            addLog('Snapshot diambil');
        }

        // Emergency system
        function triggerEmergency() {
            addLog('üö® DARURAT! Bantuan medis dipanggil');
            document.getElementById('emergencyStatus').innerHTML = 
                'üö® <span style="color: red;">DARURAT AKTIF!</span><br>Tim medis sedang dihubungi...';
            
            // Simulate emergency call
            setTimeout(() => {
                alert('üöë Tim medis telah dihubungi!\n\nNomor Darurat:\n- 119 (Ambulans)\n- 112 (Darurat)');
            }, 500);
        }

        // Auto emergency alert
        function triggerEmergencyAlert() {
            const now = Date.now();
            if (!window.lastEmergencyAlert || now - window.lastEmergencyAlert > 30000) {
                window.lastEmergencyAlert = now;
                addLog('‚ö†Ô∏è Nyeri tinggi terdeteksi - Alert otomatis');
                
                setTimeout(() => {
                    if (confirm('üö® NYERI TINGGI TERDETEKSI!\n\nApakah perlu memanggil bantuan medis?')) {
                        triggerEmergency();
                    }
                }, 1000);
            }
        }

        // Utility functions
        function updateStatus(message, type) {
            const statusEl = document.getElementById('cameraStatus');
            statusEl.textContent = message;
            statusEl.className = `status status-${type}`;
        }

        function addLog(message) {
            const logEl = document.getElementById('activityLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            logEl.insertBefore(entry, logEl.firstChild);
            
            // Keep only last 10 entries
            while (logEl.children.length > 10) {
                logEl.removeChild(logEl.lastChild);
            }
        }

        // Event listeners
        document.getElementById('startBtn').addEventListener('click', startCamera);
        document.getElementById('snapBtn').addEventListener('click', takeSnapshot);
        document.getElementById('emergencyBtn').addEventListener('click', triggerEmergency);

        // Initialize
        loadCameras();
        addLog('Sistem siap digunakan');
    </script>
</body>
</html>
